---
title: "phylo_analyses"
author: "Everyone"
date: "3/22/2018"
output: pdf_document
---


match and subset to tree.  this is annoying because the phylo packages all use row.names and the tidyverse hates rownames.


first create a new data.frame (not tibble) with just the traits of interest
```{r}
  library(phylolm)
  trait<-data.frame(mean_body_size=traits$mean_body_size,clutch_size=traits$clutch_size,gregariousness=traits$gregariousness)
  row.names(trait)<-row.names(traits)
```  

subset that dataframe to those names that are both in the trait data base AND the tree
```{r}  
  trait<-subset(trait,trait$mean_body_size!="NaN"&trait$clutch_size!="NaN"&trait$gregariousness!="NaN")
  trait<-subset(trait,row.names(trait)%in%aus_bird_tree$tip.label)
```  
  
subset the tree
```{r}
  tree_plotting<-drop.tip(aus_bird_tree,aus_bird_tree$tip.label[!aus_bird_tree$tip.label%in%row.names(trait)])
  response_variables$SCIENTIFIC_NAME<-gsub(" ","_",response_variables$SCIENTIFIC_NAME)
  rv<-filter(response_variables,SCIENTIFIC_NAME%in%tree_plotting$tip.label)
  median_rv<-as.array(rv$urban_median)
  row.names(median_rv)<-rv$SCIENTIFIC_NAME
  median_rv2<-median_rv-mean(median_rv)
  
  
  tree_plotting_2<-drop.tip(tree_plotting,tree_plotting$tip.label[!tree_plotting$tip.label%in%row.names(median_rv2)])
  trait<-subset(trait,row.names(trait)%in%tree_plotting_2$tip.label)
  
  dd <- data.frame(urb=median_rv2)

```


match traits into the right dataframe  
```{r}    
  dd$body_size<-trait$mean_body_size[match(row.names(dd),row.names(trait))]
  dd$clutch_size<-trait$clutch_size[match(row.names(dd),row.names(trait))]
  dd$gregariousness<-trait$gregariousness[match(row.names(dd),row.names(trait))]
  
```
check the corrlation of the predictors

```{r}
corrplot::corrplot(cor(dd %>% select(-gregariousness)))
```


run the model

```{r}
  mod1<-phylolm(urb~log10(body_size)+clutch_size+gregariousness,data=dd,phy=tree_plotting_2)
  summary(mod1)
```

maybe we eventually want to do model selection

```{r}
library(MuMIn)
dredge(mod1)
```

this is sort of cool.  phylogenetic signal in all the traits
  
```{r}
  library(phylosignal)
  library(phylobase)
  dd$body_size<-log10(dd$body_size)
  dd2<-subset(dd,select=-gregariousness)
  out<-phylo4d(tree_plotting_2,tip.data=dd2)
  ps<-phyloSignal(out)
  knitr::kable(ps$stat)
```
